---
- name: install linux headers
  apt:
    name: linux-headers-{{ansible_kernel}}
    state: latest
  become: true

- name: mount installer
  ansible.posix.mount:
    src: /home/vagrant/prl-tools-lin-arm.iso
    path: /tmp/parallels
    state: mounted
    fstype: iso9660
  become: true

- name: get version
  slurp:
    src: /tmp/parallels/version
  register: pt_version
  become: true

- name: print version
  debug:
    msg: "Parallels Tools Version {{ pt_version.content | b64decode }}"
  become: true

- name: install
  shell:
    cmd: /tmp/parallels/install --install-unattended-with-deps
  become: true

- name: unmount installer
  ansible.posix.mount:
    src: /home/vagrant/prl-tools-lin-arm.iso
    path: /tmp/parallels
    state: absent
    fstype: iso9660
  become: true


- name: remove iso
  file:
    path: /home/vagrant/prl-tools-lin-arm.iso
    state: absent
